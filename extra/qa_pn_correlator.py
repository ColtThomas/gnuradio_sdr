#!/usr/bin/env python
# -*- coding: utf-8 -*-
#
# Copyright 2017 <+YOU OR YOUR COMPANY+>.
#
# This is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 3, or (at your option)
# any later version.
#
# This software is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this software; see the file COPYING.  If not, write to
# the Free Software Foundation, Inc., 51 Franklin Street,
# Boston, MA 02110-1301, USA.
#

from gnuradio import gr, gr_unittest
from gnuradio import blocks
from pn_correlator import pn_correlator

class qa_pn_correlator (gr_unittest.TestCase):

    def setUp (self):
        self.tb = gr.top_block ()

    def tearDown (self):
        self.tb = None

    def test_001_t (self):
        src_data = (1,1,1,1,1,1,0,0,0,0,1,0,1,0,1,1,0,1,0,0,1,0,0,1,0,1,1,0,1,1,0,1,1,1,1,0,1,0,1,1,0,1,1,0,0,1,1,1,0,0,1,1,0,1,1,1,0,0,0,0,0,1,0,0,1,1,0,1,1,1,0,0,0,0,0,0,1,0,0,1,0,0,1,1,0,1,0,1,1,0,0,0,0,0,1,1,0,1,0,1,1,1,0,1,0,0,0,1,0,0,0,1,1,1,1,0,0,1,0,1,1,0,0,0,1,1,0,1,0,1,1,0,0,1,1,1,0,0,1,1,0,1,1,0,0,0,0,0,1,0,1,1,0,1,1,0,1,0,1,0,0,1,1,1,1,0,1,0,0,0,1,1,1,1,1,0,0,0,1,0,1,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,1,0,0,0,1,0,0,1,0,1,1,0,1,1,1,1,1,0,0,1,1,1,0,1,0,1,1,1,0,1,1,0,0,0,1,1,0,1,0,0,0,0,1,0,0,1,1,0,1,0,1,1,0,0,1,1,0,0,0,1,1,1,0,0,1,0,0,0,1,0,0,1,1,1,0,1,1,1,0,1,0,1,1,0,0,0,0,0,1,0,1,1,1,1,0,1,1,1,1,1,1,0,0,1,0,1,0,1,0,1,0,1,0,0,1,0,0,1,0,1,1,1,1,0,0,0,1,0,0,0,0,0,0,0,1,1,0,0,0,0,0,1,1,0,1,0,0,0,1,1,1,0,0,0,0,1,0,0,1,0,0,0,1,1,0,1,1,0,1,1,0,1,0,0,1,0,1,1,1,1,0,1,1,0,0,0,0,0,1,1,0,1,0,0,1,0,0,0,0,1,0,1,1,0,0,1,0,1,1,0,1,0,1,0,1,0,1,1,1,1,1,0,0,0,1,0,0,1,1,0,1,0,0,0,0,0,0,0,1,1,0,1,1,1,1,1,0,1,1,0,0,1,0,0,1,0,0,0,0,1,0,1,1,0,1,0,1,0,1,1,0,0,1,1,1,1,0,1,0,1,0,1,1,1,1,0,1,1,1,0,1,0,0,1,1,1,1,1,1,1,1,1,0,0,0,1,1,0,0,0,0,1,1,1,1,1,0,0,0,1,1,0,0,0,1,1,1,0,1,1,0,1,1,0,0,0,1,0,1,0,0,1,1,1,1,1,1,0,1,0,0,0,1,1,1,1,1,1,1,1,0,1,0,1,1,0,1,1,1,0,1,1,1,0,0,0,0,0,0,1,0,1,0,1,1,1,1,1,0,1,0,1,1,0,0,0,1,1,1,0,0,0,0,0,0,1,0,1,1,0,0,1,1,0,1,1,1,1,0,1,1,0,0,1,1,1,1,1,0,0,0,0,1,1,0,0,0,1,0,1,0,1,1,0,0,0,0,0,0,1,0,1,1,1,1,1,1,1,0,1,1,1,1,0,1,1,1,1,0,1,1,0,1,0,0,1,1,0,1,0,0,0,0,0,0,0,0,1,1,0,0,0,0,1,0,1,0,1,1,1,1,1,1,0,1,0,0,0,0,0,0,0,0,1,1,1,0,1,1,1,0,1,0,1,1,1,0,1,1,1,0,0,0,0,0,0,1,1,0,1,1,1,0,1,0,1,1,0,1,1,0,0,0,0,0,1,0,1,0,1,1,1,0,0,0,0,0,0,0,0,0,1,0,0,1,1,0,0,0,0,0,0,0,1,1,1,0,0,0,0,0,1,0,0,1,0,0,0,0,1,1,0,1,0,1,1,0,0,1,0,0,0,0,1,1,1,0,1,1,0,0,1,1,0,1,0,1,1,0,1,0,0,1,1,1,1,0,0,0,0,1,1,0,0,0,1,0,1,0,1,1,1,0,0,1,1,0,1,1,1,1,1,0,0,1,0,0,1,0,1,0,1,1,0,0,1,0,1,1,0,1,1,1,1,1,0,1,1,1,1,1,1,0,1,0,0,0,0,1,0,1,1,1,1,0,0,1,0,0,0,1,0,1,0,0,0,0,1,1,0,1,0,0,1,1,1,0,1,1,1,1,0,0,1,0,0,0,1,1,1,1,1,1,0,0,1,1,1,1,1,0,0,1,0,1,1,0,0,1,1,1,1,0,1,0,1,1,1,0,1,1,0,0,1,1,1,1,1,0,1,1,0,0,1,0,0,1,1,1,0,1,0,1,0,1,0,0,0,0,0,1,1,0,0,0,0,1,0,1,0,0,0,1,1,1,1,0,0,1,0,0,0,1,0,1,1,0,0,1,1,1,0,1,0,1,0,0,1,1,1,1,1,0,1,0,0,0,0,1,1,1,0,0,0,1,0,0,1,0,0,1,1,0,1,1,0,1,0,1,1,0,1,1,1,1,0,1,1,0,0,0,1,1,0,1,0,0,1,0,1,1,1,0,1,1,1,0,0,1,1,0,0,1,0,1,0,1,0,1,1,1,1,1,1,1,0,0,0,0,0,0,1,1,0,0,1,0,1,1,1,1,1,1,0,0,1,0,1,0,1,1,0,0,0,0,1,1,0,0,1,0,1,0,1,0,1,0,0,1,1,0,1,0,1,1,1,0,1,1,0,0,0,0,1,0,1,1,0,1,0,1,0,1,0,1,0,0,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,0,1,0,0,0,0,0,1,1,1,0,0,1,0,0,1,1,0,1,0,1,1,0,1,1,0,0,0,0,1,1,0,1,0,1,0,0,1,1,1,0,1,0,1,1,0,1,1,0,0,0,1,1,1,0,0,1,1,1,1,1,0,1,1,1,1,1,1,0,0,0,0,1,1,0,1,0,0,0,0,0,0,1,1,1,1,0,0,1,0,1,1,0,1,0,1,1,0,0,1,1,1,1,1,1,1,1,0,0,0,1,1,1,0,1,0,1,0,1,1,0,1,0,0,1,0,0,0,1,1,1,0,0,1,0,0,0,0,1,1,0,0,0,0,1,0,1,0,0,1,1,0,1,1,1,0,0,0,0,0,0,0,1,0,1,1,0,1,1,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,1,0,1,1,0,1,0,1,1,1,0,0,0,1,1,1,0,1,1,0,1,0,1,1,0,1,1,0,0,1,0,1,1,0,1,1,1,1,1,0,0,0,0,0,0,0,0,1,1,1,0,1,1,0,1,0,1,0,1,0,1,0,1,0,0,1,0,1,1,1,1,0,0,0,1,1,0,1,1,0,0,0,1,1,0,1,0,1,1,1,1,0,1,0,0,1,0,0,1,0,1,0,0,1,1,0,0,0,1,0,0,1,1,1,0,1,1,1,1,0,1,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,1,0,0,0,1,1,1,0,0,0,1,1,0,0,0,1,1,1,1,0,0,0,1,0,0,0,1,1,0,1,1,1,0,1,1,0,0,0,1,0,0,0,0,1,0,1,0,0,0,0,1,1,0,1,0,1,0,1,0,1,0,0,0,1,0,1,0,0,1,0,0,0,1,1,0,0,1,0,1,0,0,1,1,0,1,1,1,1,1,0,0,0,0,0,1,0,1,1,1,0,1,0,0,1,1,0,1,0,1,0,1,1,1,0,1,0,1,1,0,0,1,1,1,1,0,0,0,0,0,0,1,1,1,1,1,0,0,1,0,0,1,0,1,0,1,0,1,1,0,0,0,1,1,0,1,1,1,0,1,0,1,1,0,0,0,1,0,1,0,0,1,1,1,1,0,0,1,0,1,0,1,1,0,0,1,0,0,0,1,0,0,1,0,0,0,0,1,1,1,0,0,1,0,0,0,0,1,0,1,0,0,0,1,1,1,0,0,0,0,0,1,0,1,1,0,1,0,0,0,1,1,1,0,1,0,1,1,1,0,0,1,1,0,0,0,1,0,0,1,0,0,1,1,1,0,0,1,1,0,0,0,0,0,0,0,0,0,1,0,0,1,1,0,0,0,0,1,0,0,1,1,0,1,1,1,1,0,1,0,0,0,0,0,1,1,0,1,0,0,1,0,1,1,1,0,0,1,0,1,0,1,1,0,1,1,1,0,0,1,0,0,1,1,1,1,0,0,0,1,1,1,1,1,0,0,1,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,1,1,1,1,1,0,1,1,1,1,0,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,0,1,0,1,0,0,0,0,1,0,1,0,1,0,1,0,1,1,1,0,0,1,1,0,0,0,1,1,0,1,1,0,0,0,0,1,0,0,1,1,0,1,1,1,0,1,0,1,0,0,0,0,0,0,1,1,1,0,1,0,1,0,0,1,0,1,1,1,0,0,0,1,1,1,1,1,1,1,0,1,1,1,1,1,0,0,0,0,0,0,1,0,1,1,0,1,0,1,1,0,1,1,0,1,0,1,0,1,1,0,1,0,1,1,0,1,0,0,1)
        expected_result = (0,0,0,0,0,0,1,2,3,4,5,6,5,3,2,0,1,-1,0,0,0,3,2,2,2,-1,6,-1,1,0,1,4,2,1,1,3,2,2,1,6,4,8,4,5,4,4,3,6,9,2,10,3,4,10,5,1,8,3,7,10,3,13,5,8,8,-4,-1,3,-1,3,-8,9,12,-2,4,10,6,11,-5,-2,11,-2,5,6,-2,8,3,-7,-4,0,3,4,1,5,11,2,-3,5,2,-6,-4,-4,-3,-3,-5,4,1,0,5,3,3,1,4,4,-11,1,-5,-1,-3,-2,-5,9,-1,-3,9,1,-5,-1,1,-19,1,7,-7,11,5,-13,7,-3,-5,3,-9,7,-5,-1,-7,13,17,3,1,-3,1,7,-19,-7,-29,-3,-7,-3,-7,15,29,-19,-9,-1,-7,-1,-1,-1,-3,-5,-7,11,-1,11,3,-17,-9,9,1,-3,13,15,-3,13,17,-5,-7,3,-17,1,3,-7,-5,3,5,15,13,13,-17,23,-5,7,19,-25,-9,15,-17,11,-5,9,9,-7,-5,1,-1,7,-3,-3,-9,9,3,7,-9,-21,-3,7,-9,-1,-11,-1,-11,7,9,11,5,-25,5,9,-21,1,-7,9,-3,11,13,-3,15,1,-17,15,-9,-13,3,-5,3,-17,-13,-1,7,-1,-1,-1,21,-19,1,-3,9,-5,21,23,21,-23,1,1,-13,-7,13,-3,17,3,-11,1,-5,-13,-5,-5,-1,-3,-11,-17,1,-5,35,-3,-9,7,-3,-3,-15,9,-5,-13,-27,3,9,-3,3,-15,33,-5,7,5,23,15,9,5,-13,23,3,-21,-3,5,-3,19,7,-1,1,19,-19,-3,-13,19,-3,15,11,-1,-1,9,5,5,-7,-9,5,-25,-5,-11,-1,7,15,-3,-5,-13,-11,19,-9,-3,1,1,7,5,-5,-3,23,-3,-5,-1,-1,-11,5,3,-15,-1,-7,-7,-1,-5,-1,5,-17,9,11,-11,-17,11,-1,1,21,-11,-19,-3,-7,-3,3,13,21,-5,-5,7,-13,3,-11,-1,-5,-1,9,-3,-1,17,1,-9,-3,11,-19,19,-21,1,-9,-13,13,-15,-1,5,-13,7,-13,-9,-13,-1,-7,-9,-1,21,15,3,21,-7,5,-11,3,-5,5,-3,-5,11,7,-7,17,-3,-21,-23,-31,7,9,-15,25,3,7,5,-19,19,21,5,9,13,-3,-1,15,15,-9,-5,1,-11,-17,-5,15,3,15,9,-1,5,7,-9,5,1,-11,-17,3,-11,-3,-13,13,-13,-11,7,-15,3,19,7,-31,13,-5,15,-1,13,5,-1,9,-15,5,-17,5,5,-7,13,35,-7,21,-1,-7,7,-11,1,-17,-13,-3,-1,17,11,19,-5,9,15,19,-5,-9,-13,-5,9,-3,5,7,-3,11,-7,7,-3,5,-11,-1,-5,11,3,-5,5,-33,11,27,-11,11,13,17,-11,3,-1,1,-5,-9,-19,-3,-1,9,3,-13,17,-3,-1,3,11,-9,-1,13,11,3,15,13,11,15,-1,7,-11,-5,5,-11,-25,5,-3,-11,5,19,1,1,19,-5,9,-21,-15,-9,17,15,7,-7,3,-3,7,3,-15,3,-13,-3,-5,7,3,-15,-3,5,-1,-5,-19,-1,3,3,-1,3,15,-19,-19,-7,-3,-3,17,21,1,5,-5,25,-11,7,3,-21,11,11,3,-3,-5,3,9,17,9,-11,-7,-13,-5,-25,-23,-1,-9,-11,-13,17,27,5,-15,-1,-3,15,-9,-9,17,-7,3,-5,15,-7,9,11,-3,-5,-15,-1,-3,-1,-3,11,9,-3,-11,-5,1,-15,5,-9,-5,3,7,11,-1,-7,-25,-15,29,-5,23,-3,-3,7,15,1,15,5,17,1,-5,-3,-21,-1,-5,-13,-3,5,5,9,1,-3,-5,-15,-9,-17,19,1,-3,-5,17,-17,-3,-17,7,-19,-15,-21,-5,13,7,15,29,-1,5,3,9,7,9,-1,5,-3,15,15,-5,-17,5,-15,-15,-13,-5,1,29,7,-3,13,7,-1,-1,-3,-5,-11,-15,-9,-3,-9,9,-13,7,11,1,-9,-11,-13,-11,1,-11,3,5,-7,17,7,1,-15,-3,11,-9,-9,-11,-5,11,11,15,-3,17,-7,5,-7,-5,-9,-9,-5,-19,-13,-5,13,-1,-13,-1,-17,-3,-3,13,-17,11,3,25,3,-3,-5,5,-19,-7,1,-11,-3,5,-9,23,-3,-7,-13,9,7,-27,-15,29,-21,7,3,3,9,15,-35,-13,-11,-5,7,1,-15,33,11,7,-7,-9,-3,15,-9,5,-7,-3,11,-7,-1,3,13,19,-21,5,-15,9,1,5,-3,7,9,-9,-1,5,9,-7,13,21,17,1,3,-5,-13,5,9,9,3,7,3,3,19,17,9,17,5,-3,5,-1,-5,-1,17,-5,-13,-11,7,-27,-1,3,1,5,-5,17,7,-11,5,3,7,17,-1,9,1,21,-23,-11,-25,-9,5,11,-9,15,-1,-19,3,5,9,7,-7,-3,-13,11,-1,3,-15,15,-9,-23,19,3,-3,15,-3,1,11,9,-3,-9,7,11,-15,3,-7,11,-19,11,13,11,3,-5,3,11,-7,3,-7,-7,1,1,15,3,17,-5,1,-1,-11,-15,-1,-7,7,-15,25,3,5,-21,13,-7,-15,-3,-13,1,9,17,7,3,5,-3,3,3,15,-19,-15,5,5,9,3,-7,-13,3,15,11,-3,5,7,-31,-19,-5,13,-9,19,5,-13,1,1,3,-15,-3,-7,-1,1,13,-7,5,13,3,-17,-19,-15,3,7,1,5,-7,-15,15,11,-9,-9,5,-19,-17,15,-3,-3,9,5,-11,3,9,-1,-5,5,-9,-9,-19,-5,-1,3,5,3,-3,-5,1,7,-11,5,-5,-1,-5,7,1,-1,1,-3,-5,-3,-7,-3,-5,-1,-3,1,-1,127,-1,-3,-3,-3,-5,-5,-5,-1,-3,-5,-3,-5,-3,-3,-3,5,3,7,3,3,5,-1,11,3,-1,5,1,-3,-11,-7,-3,3,1,-3,5,7,5,7,-1,3,11,-1,-15,-7,1,-13,-1,3,7,5,1,-7,3,3,7,11,-7,-9,11,-3,3,-7,1,5,5,-3,-13,3,13,-7,1,1,-19,17,-21,3,-1,-5,-15,9,1,13,-5,-5,-5,-5,11,-11,15,5,13,3,-21,-7,-13,1,3,15,5,3,3,1,-9,-15,-9,-5,13,-11,-5,-1,-7,-1,-1,-1,3,1,13,-21,5,-3,13,-5,-13,9,5,-21,17,7,-1,-7,1,-21,3,3,-5,-1,5,-1,11,-11,-1,-13,5,-17,-7,5,-3,-5,-15,27,23,13,7,-13,21,-7,-3,1,-7,7,19,-7,1,13,-11,1,3,-17,-5,-7,-15,19,1,9,-1,17,-11,19,-15,-9,-1,-5,15,-7,-3,7,3,-11,-3,-3,-25,15,5,19,3,13,9,3,5,-5,1,-13,5,11,5,1,1,-21,15,3,7,13,-1,-17,11,-23,-1,13,3,7,-7,21,-15,-7,15,5,15,5,-5,1,3,13,5,-5,-7,-9,9,13,-13,-11,9,-1,11,-7,3,3,-1,11,-15,-13,-13,-39,3,9,5,-1,-7,3,7,3,1,-1,-5,-1,3,-3,-11,-5,-9,-1,-29,-9,1,5,1,9,-13,7,11,-7,27,-21,9,15,3,-17,-15,-3,-21,-3,-3,9,13,3,-7,3,-9,-13,17,-21,-1,5,-3,-17,-13,-7,9,1,-1,-7,3,-3,7,15,3,-21,-5,9,-1,-11,-7,-21,17,-1,-7,-1,9,23,11,7,9,3,11,-9,9,-17,-11,-17,1,3,33,-5,9,3,-11,1,5,3,-5,5,-11,11,15,-13,5,-3,-13,-1,-1,-19,1,21,7,13,11,7,1,1,-31,15,9,3,3,-11,21,-7,7,7,-5,1,21,-1,1,3,-9,3,-7,17,5,-17,-1,3,13,-3,13,7,-11,1,-25,11,23,-25,-17,7,-9,7,-13,3,11,-5,13,-17,13,-7,5,3,-11,-5,-5,-25,-3,-3,3,-1,-1,-7,17,-1,-1,7,13,5,-1,-3,-3,-5,-3,-15,9,5,13,3,-7,-3,-1,-1,11,-5,-17,13,1,-5,-15,-11,1,-11,9,-13,-7,-9,5,13,11,17,1,3,-1,3,-11,1,-19,-1,7,3,-3,-3,-5,-9,-1,-1,-9,-7,-9,19,17,-13,-7,-21,15,1,3,1,5,-29,-1,-5,19,-7,11,5,-1,-7,-29,-5,1,1,-3,-11,13,-1,3,1,11,11,17,-3,3,-13,-3,9,-5,-1,1,-17,9,-13,23,17,-13,-15,-3,13,11,-5,3,3,-7,-3,13,-7,-1,3,-15,21,5,7,-1,9,-9,1,1,-9,-1,-7,-5,9,-11,3,-13,1,9,5,9,-11,-3,17,21,1,1,11,11,11,7,-3,-23,-1,-9,-25,5,23,-5,7,15,-11,3,15,-9,-5,5,1,3,-1,9,7,17,5,25,-25,1,-29,5,-9,5,-17,23,21,5,-5,5,-11,-3,-5,-1,-7,13,-7,13,-17,-9,7,3,3,-11,-21,9,1,19,-25,-1,5,13,-9,7,-21,3,-25,-13,3,-7,9,-9,5,-5,-9,15,-3,15,-15,-15,15,-9,-3,7,13,11,-3,-15,-23,-5,-9,5,3,9,11,15,19,-7,-23,21,5,9,-5,-15,-15,-7,-9,5,-23,-13,3,21,25,-9,-15,-7,1,3,-13,3,-5,-7,5,-11,-3,23,5,1,-11,11,-11,-29,-9,9,-5,-3,9,5,3,-11,-13,11,-5,13,1,1,-5,-3,1,-7,1,5,-3,9,-5,1,1,-7,-9,-5,23,15,-7,-5,9,15,5,-11,-7,9,5,-9,29,3,1,15,7,-1,-13,-15,-1,-1,5,11,-9,-13,13,-9,-19,-15,-1,-17,13,1,-9,29,-13,9,15,3,17,5,-11,-9,5,-5,-3,-1,1,-3,3,5,3,-5,15,13,-1,9,17,1,-1,-9,13,5,7,3,-23,7,-11,-17,-25,9,1,-17,25,-3,11,11,-3,-3,7,-3,13,-9,-3,11,19,-5,-1,7,-3,7,-5,7,-13,1,-17,-15,-3,5,1,-1,-11,15,-1,-13,-1,9,-15,13,-11,-9,-15,7,-11,1,9,19,-9,-27,9,7,1,5,17,3,1,-9,-21,-5,1,-19,-11,19,5,-3,1,5,7,27,-1,27,-9,-1,-11,23,1,-29,-5,-19,3,3,-9,11,1,-7,7,-11,15,-5,7,13,3,-9,9,-7,-3,-1,-23,5,1,14,1,6,15,2,17,-4,21,-10,13,6,-3,6,-23,6,5,-8,11,18,-11,-10,-13,-2,-15,-2,5,-12,21,-4,-5,18,-13,6,3,8,9,-2,3,2,-5,2,-11,20,15,4,7,-10,-11,6,-11,6,-3,2,11,4,1,2,-21,-6,11,0,-1,0,-5,-4,3,6,1,2,1,2,-7,2,-9,4,-11,4,-7,-12,-1,-2,1,0,-1,8,-7,2,-1,-2,-1,6,5,-2,1,0,-3,2,-7,4,-5,0,5,-2,-5,-6,1,-4,1,8,-7,0,-3,-2,3,0,1,-2,-3,-2,3,2,-1,2,-1,-2,1)
        print "size of the test vector: ",len(src_data)
        src = blocks.vector_source_f (src_data)
        pn = pn_correlator()
        snk = blocks.vector_sink_f ()
        self.tb.connect (src, pn)
        self.tb.connect (pn, snk)
        self.tb.run ()
        result_data = snk.data ()
        # print "expected_result: ",expected_result[0:126]
        # print "actual results: ",result_data[0:126]
        self.assertFloatTuplesAlmostEqual (expected_result[0:126], result_data[0:126], 6)


if __name__ == '__main__':
    gr_unittest.run(qa_pn_correlator, "qa_pn_correlator.xml")
